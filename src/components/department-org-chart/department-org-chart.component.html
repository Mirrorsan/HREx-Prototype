<div #chartContainer class="relative w-full h-full overflow-hidden rounded-lg bg-white/60 backdrop-blur-sm border border-slate-200/50" (mousedown)="onPanStart($event)">
  
  <!-- Chart Content -->
  <div #chartContent 
    class="absolute top-1/2 left-1/2 cursor-grab"
    [class.cursor-grabbing]="isPanning()"
    [class.transition-transform]="!isPanning()"
    [style.transform]="'translate(calc(-50% + ' + panOffset().x + 'px), calc(-50% + ' + panOffset().y + 'px)) scale(' + zoomLevel() + ')'"
    [style.transform-origin]="'center'"
    >
    <div class="org-tree">
      <ul>
        @for(node of tree(); track node.id) {
          <li>
            <ng-container [ngTemplateOutlet]="nodeTemplate" [ngTemplateOutletContext]="{ $implicit: node }"></ng-container>
          </li>
        }
      </ul>
    </div>
  </div>

  <!-- Zoom Controls -->
  <div class="absolute bottom-4 right-4 flex items-center gap-1 bg-white/80 backdrop-blur-sm rounded-lg shadow-md border p-1">
     <button (click)="centerView()" class="p-2 rounded-md hover:bg-slate-100 text-slate-500 hover:text-slate-700" title="Center View">
      <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5M15 15l5.25 5.25" /></svg>
    </button>
    <button (click)="zoomOut()" class="p-2 rounded-md hover:bg-slate-100 text-slate-500 hover:text-slate-700" title="Zoom Out">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"></path></svg>
    </button>
    <div class="px-2 text-sm font-medium text-slate-600 min-w-[40px] text-center">{{ Math.round(zoomLevel() * 100) }}%</div>
    <button (click)="zoomIn()" class="p-2 rounded-md hover:bg-slate-100 text-slate-500 hover:text-slate-700" title="Zoom In">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"></path></svg>
    </button>
  </div>
</div>


<!-- Recursive Node Template -->
<ng-template #nodeTemplate let-node>
  <div class="node-content">
    <div class="node-card relative inline-block bg-white rounded-lg shadow-md p-4 min-w-[220px] text-center">
      <h3 class="font-bold text-base text-slate-800">{{ node.name }}</h3>
      @if (node.manager) {
        <div class="flex items-center gap-2 mt-2 justify-center">
            <img [src]="node.manager.avatar" class="w-6 h-6 rounded-full object-cover">
            <p class="text-xs text-slate-500">Managed by {{ node.manager.name }}</p>
        </div>
      }
      <p class="text-sm font-semibold text-slate-600 mt-2 bg-slate-100 inline-block px-2 py-0.5 rounded-full">{{ node.memberCount }} members</p>
    </div>
  </div>

  @if (node.children.length > 0) {
    <ul>
      @for(child of node.children; track child.id) {
        <li>
          <ng-container [ngTemplateOutlet]="nodeTemplate" [ngTemplateOutletContext]="{ $implicit: child }"></ng-container>
        </li>
      }
    </ul>
  }
</ng-template>