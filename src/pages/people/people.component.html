<div class="p-4 sm:p-6 lg:p-8 space-y-6 h-full flex flex-col">
  <!-- Control Panel Card -->
  <div class="bg-white rounded-xl shadow-sm p-4 sm:p-6">
    <div class="flex flex-col sm:flex-row justify-between sm:items-center gap-4">
      <h1 class="text-2xl font-bold text-slate-800">Employees</h1>
      <div class="flex items-center bg-slate-100 p-1 rounded-lg">
        <button (click)="setView('list')" [class]="activeView() === 'list' ? 'bg-slate-800 text-white shadow-sm' : 'bg-transparent text-slate-600 hover:bg-white/60'" class="px-4 py-1.5 rounded-md text-sm font-medium transition-all">
          Directory
        </button>
        <button (click)="setView('orgChart')" [class]="activeView() === 'orgChart' ? 'bg-slate-800 text-white shadow-sm' : 'bg-transparent text-slate-600 hover:bg-white/60'" class="px-4 py-1.5 rounded-md text-sm font-medium transition-all">
          Org Chart
        </button>
      </div>
    </div>

    <!-- Actions and Search -->
    <div class="mt-4 border-t border-slate-200 pt-4 flex flex-col sm:flex-row justify-between sm:items-center gap-4">
      <div class="flex flex-col sm:flex-row items-center gap-4 flex-grow w-full">
        <!-- Search Input -->
        <div class="relative w-full sm:max-w-xs">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
          </div>
          <input type="text" (input)="onSearch($event)" [value]="searchQuery()" placeholder="Search..." class="block w-full pl-10 pr-3 py-2 border border-slate-300 rounded-md leading-5 bg-white placeholder-slate-500 focus:outline-none focus:placeholder-slate-400 focus:ring-1 focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm">
        </div>
        <!-- Filters -->
        <div class="flex items-center gap-2 w-full sm:w-auto">
          <select (change)="onDepartmentChange($event)" class="w-full sm:w-auto block border border-slate-300 rounded-md py-2 px-3 text-sm focus:ring-yellow-500 focus:border-yellow-500 text-slate-700">
            @for(dept of departments(); track dept) {
              <option [value]="dept">{{ dept === 'all' ? 'All Departments' : dept }}</option>
            }
          </select>
           <select (change)="onSiteChange($event)" class="w-full sm:w-auto block border border-slate-300 rounded-md py-2 px-3 text-sm focus:ring-yellow-500 focus:border-yellow-500 text-slate-700">
            @for(site of sites(); track site) {
              <option [value]="site">{{ site === 'all' ? 'All Sites' : site }}</option>
            }
          </select>
           <select (change)="onStatusChange($event)" class="w-full sm:w-auto block border border-slate-300 rounded-md py-2 px-3 text-sm focus:ring-yellow-500 focus:border-yellow-500 text-slate-700">
            @for(status of statuses(); track status) {
              <option [value]="status">{{ status === 'all' ? 'All Statuses' : status }}</option>
            }
          </select>
        </div>
      </div>
      <div class="flex items-center justify-end gap-2 shrink-0">
        @if (canAddEmployee()) {
          <button (click)="openAddEmployeeModal()" class="h-9 px-4 inline-flex items-center justify-center gap-2 text-sm font-medium text-white bg-slate-800 rounded-md shadow-sm hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-800">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
            Add Employee
          </button>
        }
        @if (canExportList()) {
          <button class="h-9 px-4 inline-flex items-center justify-center gap-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-md shadow-sm hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
            Export
          </button>
        }
      </div>
    </div>
  </div>

  <!-- Content Area -->
  @if (activeView() === 'list') {
    <div class="mt-0 bg-white rounded-xl shadow-sm overflow-hidden flex-1 flex flex-col">
      <div class="overflow-auto flex-grow">
        <table class="min-w-full divide-y divide-slate-200">
          <thead class="bg-slate-50 sticky top-0 z-10">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Name</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Nickname</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Job title</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Department</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Site</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Salary</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Start date</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Status</th>
              @if(canManageEmployees()) {
                <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">Actions</th>
              }
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-slate-200">
            @for (employee of paginatedEmployees(); track employee.id; let i = $index) {
              <tr class="animate-row hover:bg-slate-50" [style.animation-delay]="i * 30 + 'ms'">
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="flex-shrink-0 h-10 w-10">
                      <img class="h-10 w-10 rounded-full object-cover" [src]="employee.avatar" alt="">
                    </div>
                    <div class="ml-4">
                      <div class="text-sm font-medium text-slate-900">{{ employee.name }}</div>
                      <div class="text-sm text-slate-500">{{ employee.email }}</div>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">{{ employee.nickname }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900 font-medium">{{ employee.jobTitle }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">{{ employee.department }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">{{ employee.siteEmoji }} {{ employee.site }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">{{ employee.salary }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">{{ employee.startDate | date }}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                  @if (employee.status === 'Active') {
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Active</span>
                  } @else if (employee.status === 'On Leave') {
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">On Leave</span>
                  } @else if (employee.status === 'Invited') {
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">Invited</span>
                  }
                </td>
                @if(canManageEmployees()) {
                  <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                    <div class="relative inline-block text-left">
                       <button (click)="toggleActionMenu(employee.id)" class="p-1 rounded-full text-slate-400 hover:text-slate-600 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-100 focus:ring-slate-500">
                          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"></path></svg>
                       </button>
                       @if(activeActionMenu() === employee.id) {
                          <div class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-10">
                            <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="options-menu">
                              @if(canEditEmployee()) {
                                <button (click)="editEmployee(employee)" class="w-full text-left block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 hover:text-slate-900" role="menuitem">Edit Employee</button>
                              }
                              @if(canDeleteEmployee()) {
                                <button (click)="deleteEmployee(employee.id)" class="w-full text-left block px-4 py-2 text-sm text-red-600 hover:bg-red-50 hover:text-red-700" role="menuitem">Delete Employee</button>
                              }
                              @if(canEditStatus()) {
                                <div class="border-t border-slate-100 my-1"></div>
                                @for(status of availableStatuses; track status) {
                                  @if(status !== employee.status) {
                                    <button (click)="changeStatus(employee.id, status)" class="w-full text-left block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 hover:text-slate-900" role="menuitem">
                                      Set as {{ status }}
                                    </button>
                                  }
                                }
                              }
                            </div>
                          </div>
                       }
                    </div>
                  </td>
                }
              </tr>
            } @empty {
              <tr>
                <td [attr.colspan]="canManageEmployees() ? 9 : 8" class="text-center py-12">
                  <div class="text-slate-500">
                    @if(searchQuery()) {
                      No employees found for "{{ searchQuery() }}".
                    } @else {
                      No employees match the current filters.
                    }
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Pagination Controls -->
      @if (filteredEmployees().length > 0) {
        <div class="p-4 border-t border-slate-200 flex items-center justify-between">
          <div class="text-sm text-slate-600">
            Showing <span class="font-medium">{{ (currentPage() - 1) * pageSize + 1 }}</span> to <span class="font-medium">{{ (currentPage() - 1) * pageSize + paginatedEmployees().length }}</span> of <span class="font-medium">{{ filteredEmployees().length }}</span> results
          </div>
          @if (totalPages() > 1) {
            <div class="flex items-center gap-2">
              <button (click)="previousPage()" [disabled]="currentPage() === 1" class="px-3 py-1.5 text-sm font-medium text-slate-600 bg-white border border-slate-300 rounded-md shadow-sm hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed">
                Previous
              </button>
              <span class="text-sm text-slate-500">
                Page {{ currentPage() }} of {{ totalPages() }}
              </span>
              <button (click)="nextPage()" [disabled]="currentPage() === totalPages()" class="px-3 py-1.5 text-sm font-medium text-slate-600 bg-white border border-slate-300 rounded-md shadow-sm hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed">
                Next
              </button>
            </div>
          }
        </div>
      }
    </div>
  } @else {
    <div class="mt-0 flex-1 min-h-0">
      <app-org-chart></app-org-chart>
    </div>
  }
</div>

@if (showAddEmployeeModal()) {
  <app-add-employee-modal (close)="closeAddEmployeeModal()" (add)="handleAddEmployee($event)"></app-add-employee-modal>
}